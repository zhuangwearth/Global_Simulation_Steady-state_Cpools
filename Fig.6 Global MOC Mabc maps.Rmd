---
title: "Compare differences between predicted and observed Cphs MOC"
output: html_notebook
---
Aim: Compare differences between predicted and observed MOC

Step:
(1) Load predicted and observed MOC; (2) plot maps 

# Load libaray and data  
```{r}
library(ggplot2)
library(ggpubr)
library(rgdal) # contain readOGR
library(raster)
library(rgeos) # contain function "gSimplify"
library(leaflet)
library(broom) # if you plot with ggplot and need to turn sp data into dataframes
library(oceanmap)
```

```{r function transform a vector to dataframe of map}
vector_map_df = function(ivar)
   {Mc = matrix(ivar, ncol=720, nrow=360) 
    Mc = t(Mc)
    Mc_ras = matrix2raster(Mc)
    
    # add coords
    crs(Mc_ras) <- crs(bulkD_map)
    extent(Mc_ras) = extent(bulkD_map)
      
    Mc_df = as.data.frame(Mc_ras, xy=T)
    colnames(Mc_df) = poolname
    return(Mc_df)
}
```
 
## Load data    
```{r Load Coastline map}
# load coastlines
coastlines <- readOGR("../../inputData/map/ne_110m_coastline/ne_110m_coastline.shp")
# simplify with a lower tolerance value (keeping more detail)
coastlines_sim2 <- gSimplify(coastlines, 
                             tol = .1, 
                             topologyPreserve = TRUE)
# turn the data into a spatial data frame 
coastlines_sim2_df <- SpatialLinesDataFrame(coastlines_sim2,
                                            coastlines@data) 
```    
```{r 1.0  Load TSOC HWSD observed}
# Load TSOC from HWSD
tsoc_hwsd = raster('../../inputData/HWSD/SOC_1m_0.5deg.tif')
# The data is available at http://dx.doi.org/10.3334/ORNLDAAC/1247
poolname = c('x', 'y', 'Cpool')

tsoc_df <-
  as.data.frame(tsoc_hwsd , xy = TRUE)
colnames(tsoc_df) = poolname
``` 

    
```{r 1.0  Load MOC observed}
# load bulk density
bulkD_map = raster('../../inputData/HWSD/bulkD_1m_0.5deg.tif')
# The data is available at http://dx.doi.org/10.3334/ORNLDAAC/1247

# Load observed MOC
#  The mineral-associated organic carbon dataset is available at https://doi.org/10.5281/zenodo.6539765)
# top soil
MOC_t = raster('../../inputData/MAOM_Globe/rawdata/moc_t.nc') # unit kgC/m2
# sub soil
MOC_s = raster('../../inputData/MAOM_Globe/rawdata/moc_s.nc')

# whole soils
MOC_ras = MOC_s  + MOC_t
poolname = c('x', 'y', 'Cpool')
##  MOC
MOC_df <-
  as.data.frame(MOC_ras, xy = TRUE)
colnames(MOC_df) = poolname

mean(na.omit(MOC_df$Cpool));
sd(na.omit(MOC_df$Cpool));
min(na.omit(MOC_df$Cpool));
max(na.omit(MOC_df$Cpool))
```
##  Load Cphs in MIMICSa
```{r 1.1  Cphs in MIMICSa }
### MIMICSa
soc_mod = read.csv('../../output/Cpools_MIMICSabc.csv')
tsoc_Ma = soc_mod[,5] + soc_mod[,6] + soc_mod[,7] + soc_mod[,8] + soc_mod[,9]

# MOC
Ma = matrix(soc_mod[,7], ncol=720, nrow=360) 
Ma = t(Ma)
Ma_ras = matrix2raster(Ma)

# add coords
crs(Ma_ras) <- crs(bulkD_map)
extent(Ma_ras) = extent(bulkD_map)
  
Ma_df = as.data.frame(Ma_ras, xy=T)
colnames(Ma_df) = poolname

mean(na.omit(Ma_df$Cpool));
min(na.omit(Ma_df$Cpool));
max(na.omit(Ma_df$Cpool))
```

##  Load Cphs in MIMICSb
```{r 1.2  Cphs in MIMICSb default Qmax }
### MIMICSb
tsoc_Mb = soc_mod[,12] + soc_mod[,13] + soc_mod[,14] + soc_mod[,15] + soc_mod[,16] 

# MOC
Mb = matrix(soc_mod[,14], ncol=720, nrow=360) 
Mb = t(Mb)
Mb_ras = matrix2raster(Mb)

# add coords
crs(Mb_ras) <- crs(bulkD_map)
extent(Mb_ras) = extent(bulkD_map)
  
Mb_df = as.data.frame(Mb_ras, xy=T)
colnames(Mb_df) = poolname

mean(na.omit(Mb_df$Cpool));
min(na.omit(Mb_df$Cpool));
max(na.omit(Mb_df$Cpool))
```

```{r}
boxplot(Mb_df$Cpool)
```

```{r}
# remove abnormal point
Mb_df[Mb_df$Cpool > 140 &  !is.na(Mb_df$Cpool),]$Cpool = NA
```

##  Load Cphs in MIMICSc
```{r 1.3 MOC Mc i.e. Mb with MOCmax }
### MIMICSc
tsoc_Mc =  soc_mod[,19] + soc_mod[,20] + soc_mod[,21] + soc_mod[,22] + soc_mod[,23] 

Mc = matrix(soc_mod[,21], ncol=720, nrow=360) 
Mc = t(Mc)
Mc_ras = matrix2raster(Mc)

# add coords
crs(Mc_ras) <- crs(bulkD_map)
extent(Mc_ras) = extent(bulkD_map)
  
Mc_df = as.data.frame(Mc_ras, xy=T)
colnames(Mc_df) = poolname

mean(na.omit(Mc_df$Cpool));
min(na.omit(Mc_df$Cpool));
max(na.omit(Mc_df$Cpool))
```

# Plot maps of MOC
```{r just for plot to uniform legend}
# just for plot to uniform legend
max = max(na.omit(MOC_df)$Cpool)
Ma_df[Ma_df$x ==  -179.25 & Ma_df$y ==  -89.75,]$Cpool = max

Mb_df[Mb_df$x ==  -179.25 & Mb_df$y ==  -89.75,]$Cpool = max
Mc_df[Mc_df$x ==  -179.25 & Mc_df$y ==  -89.75,]$Cpool =  max
```


```{r}
## set color bands
color_bands_TSOC5 = c(# 0-10
  colorRampPalette(c("white",      "grey"))(10 ),      # 0-1
  colorRampPalette(c("grey",      "yellow"))(10),      # 1-2
  colorRampPalette(c("yellow",      "gold2"))(10),     # 2-3
  colorRampPalette(c("gold2",     "greenyellow"))(20), # 3-5
  colorRampPalette(c("greenyellow",  "green"))(10),    # 5-6
  colorRampPalette(c("green", "green4"))(20),          # 6-8
  colorRampPalette(c("green4", "blue"))(20),           # 8-10
  colorRampPalette(c("blue", "blue4"))(50),            # 10-15
  colorRampPalette(c("blue4",   "purple"))(50),        # 15-20
  colorRampPalette(c("purple",   "red"))(50),          # 20-25
  colorRampPalette(c("red", "red4"))(50),              # 25-30
  colorRampPalette(c("red4", "hotpink"))(150))         # 30-45
```

```{r set theme}
### define theme
theme_new = function(base_size=12)
{theme(panel.background = element_rect(fill='white', colour=NA),
       panel.grid = element_blank(),
       legend.position = 'bottom',
       legend.key.height = unit(0.25, 'cm'),
       legend.key.width = unit(1.85, 'cm'),
       axis.ticks.length = unit(-0.1, 'cm'),
       axis.text = element_text(size= base_size, margin = unit(-0.3, 'cm')),
       axis.title = element_text(size= base_size),
       legend.text = element_text(size= 13),
       legend.title = element_text(size= 13))} 
theme_set(theme_bw())

lat.lab = c('60°S', '30°S', '0°', '30°N', '60°N', '90°N')
long.lab = c('180°W', '120°W', '60°W', '0°', '60°E', '120°E', '180°E')
```

## Plot Panel a:  MOC  for HWSD
```{r Panel a:  MOC  for HWSD}
stitle = 18
# Fig
p.MOC = ggplot() + 
  geom_tile(
    data = na.omit(MOC_df), aes(x = x, y = y, fill = Cpool)
  ) +
  geom_point(aes(x=-179.25, y=-89.75),colour="white") + # remove added point for plotting
  geom_path(data = coastlines_sim2_df, 
            aes(x = long, y = lat, group = group),
            size=0.015) +
  scale_fill_gradientn(colours = color_bands_TSOC5,
                       name = latex2exp::TeX('$\\textit{C}_{Phs}$')) +
  scale_x_continuous(limits = c(-180, 180), 
                     breaks = seq(-180, 180, 60),
                     label  = long.lab) +
  scale_y_continuous(limits = c(-60, 90), 
                     breaks = seq(-60, 90, 30),
                     label  = lat.lab) +
  theme(axis.text.y.left = element_text(margin = unit(c(1, 1,1, 1), "mm"))) +
  theme_new()+
  labs(title = latex2exp::TeX('( \\textbf{a} ) $\\textit{C}_{Phs}$ Observed'), size = stitle) +
  # ggtitle('(a) MIMICSa')+
  xlab('')+
  ylab('')+
  coord_quickmap()

#r save Panel a
p.MOC
ggsave(paste0(path, 'figs/Fig.6/Fig.6-a.tif'),width = 6, height = 4, dpi= 300)
```

## Plot Panel b: MOC for MIMICSa
```{r Panel b: MOC for MIMICSa}
# Fig.(b) Cphs Ma 
p.moc_Ma = ggplot() + 
  geom_tile(
    data = na.omit(Ma_df), aes(x = x, y = y, fill = Cpool)
  ) +
  geom_point(aes(x=-179.25, y=-89.75),colour="white") + # remove added point for plotting
  geom_path(data = coastlines_sim2_df, 
            aes(x = long, y = lat, group = group),
            size=0.015) +
  scale_fill_gradientn(colours = color_bands_TSOC5,
                       name = latex2exp::TeX('$\\textit{C}_{Phs}$')) +
  scale_x_continuous(limits = c(-180, 180), 
                     breaks = seq(-180, 180, 60),
                     label  = long.lab) +
  scale_y_continuous(limits = c(-60, 90), 
                     breaks = seq(-60, 90, 30),
                     label  = lat.lab,
                     position = "right", 
                     sec.axis = sec_axis(~., labels = NULL)) +
  theme(axis.text.y.right = element_text(margin = unit(c(1, 1,1, 1), "mm")),
        axis.ticks.y.left = element_blank()) +
  theme_new()+
  labs(title = latex2exp::TeX('( \\textbf{b} ) $\\textit{C}_{Phs}$ for MIMICSa '), size = stitle) +
  # ggtitle('(a) MIMICSa')+
  xlab('')+
  ylab('')+
  coord_quickmap()

# save Panel b
p.moc_Ma 
ggsave(paste0(path, 'figs/Fig.6/Fig.6-b.tif'),width = 6, height = 4, dpi= 300)
```

## Plot Panel d: MOC for MIMICSb
```{r Panel d: MOC for MIMICSb}
# Fig. MOC 
p.moc_Mb = ggplot() + 
  geom_tile(
    data = na.omit(Mb_df), aes(x = x, y = y, fill = Cpool)
  ) +
  geom_point(aes(x=-179.25, y=-89.75),colour="white") + # remove added point for plotting
  geom_path(data = coastlines_sim2_df, 
            aes(x = long, y = lat, group = group),
            size=0.015) +
  scale_fill_gradientn(colours = color_bands_TSOC5,
                       name = latex2exp::TeX('$\\textit{C}_{Phs}$')) +
  scale_x_continuous(limits = c(-180, 180), 
                     breaks = seq(-180, 180, 60),
                     label  = long.lab) +
  scale_y_continuous(limits = c(-60, 90), 
                     breaks = seq(-60, 90, 30),
                     label  = lat.lab) +
  theme(axis.text.y.left = element_text(margin = unit(c(1, 1,1, 1), "mm"))) +
  theme_new()+
  labs(title = latex2exp::TeX('( \\textbf{d} ) $\\textit{C}_{Phs}$ for MIMICSb with default $\\textit{Q}_{max}$'), size = stitle) +
  # ggtitle('(a) MIMICSa')+
  xlab('')+
  ylab('')+
  coord_quickmap()

#  save Panel d
p.moc_Mb 
ggsave(paste0(path, 'figs/Fig.6/Fig.6-d.tif'),width = 6, height = 4, dpi= 300)
```

## Plot Panel e: MOC for MIMICSc
```{r Panel e: MOC for MIMICSb with MOCmax}
# Fig.(e) Cphs Mc 
p.moc_Mc = ggplot() + 
  geom_tile(
    data = na.omit(Mc_df), aes(x = x, y = y, fill = Cpool)
  ) +  
  geom_point(aes(x=-179.25, y=-89.75),colour="white") + # remove added point for plotting
  geom_path(data = coastlines_sim2_df, 
            aes(x = long, y = lat, group = group),
            size=0.015) +
  scale_fill_gradientn(colours = color_bands_TSOC5,
                       name = latex2exp::TeX('$\\textit{C}_{Phs}$')) +
  scale_x_continuous(limits = c(-180, 180), 
                     breaks = seq(-180, 180, 60),
                     label  = long.lab) +
  scale_y_continuous(limits = c(-60, 90), 
                     breaks = seq(-60, 90, 30),
                     label  = lat.lab,
                     position = "right", 
                     sec.axis = sec_axis(~., labels = NULL)) +
  theme(axis.text.y.right = element_text(margin = unit(c(1, 1,1, 1), "mm")),
        axis.ticks.y.left = element_blank()) +
  theme_new()+
  labs(title = latex2exp::TeX('( \\textbf{e} ) $\\textit{C}_{Phs}$ for MIMICSc (i.e. MIMICSb with $\\MOC_{max}$)'), size = stitle) +
  # ggtitle('(a) MIMICSa')+
  xlab('')+
  ylab('')+
  coord_quickmap()

# save Panel e
p.moc_Mc 
ggsave(paste0(path, 'figs/Fig.6/Fig.6-e.tif'),width = 6, height = 4, dpi= 300)
```

## Plot Panel g: Qmax
```{r load Qmax unit kgC/m2}
clay_map = raster('../../inputData/HWSD/CLAY_1m_0.5deg.tif')
clay_df = as.data.frame(clay_map, xy=T) 
bulkD_df = as.data.frame(bulkD_map, xy=T)  

  # Qmax  = 10^(0.297 * log10(CLAY) + 3.355)/1000 # unit, g C kg-1 Soil)
  # Qmax  = bulkD * Qmax                          # mg C per cm3 Soil

qmax_df =  clay_df
colnames(qmax_df) = poolname
qmax_df$Cpool = 10^(0.297 * log10(clay_df[,3]) + 3.355)/1000 * bulkD_df[,3] 
 # unit, mg/cm3
# 1 m depth soil unit: kg/m2

mean(na.omit(qmax_df$Cpool));
min(na.omit(qmax_df$Cpool));
max(na.omit(qmax_df$Cpool))
```

```{r load MOCmax 1 m depth unit kgC/m2}
# Load observed MOCmax from https://doi.org/10.5281/zenodo.6539765
MOCmax_ras = raster('../../inputData/MAOM_Globe/rawdata/mocMax1m_mg_per_cm3.nc') 

MOCmax_df = as.data.frame(MOCmax_ras, xy=T)
colnames(MOCmax_df) = poolname

mean(na.omit(MOCmax_df$Cpool));
min(na.omit(MOCmax_df$Cpool));
max(na.omit(MOCmax_df$Cpool))
```

```{r}
plot(MOCmax_ras)
```

```{r}
boxplot(MOCmax_df$Cpool);
hist(MOCmax_df$Cpool)
```

```{r just for plot to uniform legend qmax}
# just for plot to uniform legend
qmax_df[qmax_df$x ==  -179.25 & qmax_df$y ==  -89.75,]$Cpool = 70
MOCmax_df[MOCmax_df$x ==  -179.25 & MOCmax_df$y ==  -89.75,]$Cpool = 140
```

## Plot Panel g: Qmax
```{r Panel g: plot Qmax}

p.qmax = ggplot() + 
  geom_tile(
    data = na.omit(qmax_df), aes(x = x, y = y, fill = Cpool )
  ) + 
  geom_point(aes(x=-179.25, y=-89.75),colour="white") + # remove added point for plotting
  geom_path(data = coastlines_sim2_df, 
            aes(x = long, y = lat, group = group),
            size=0.02) +
  scale_fill_gradientn(colours = color_bands_TSOC5, 
                       name = latex2exp::TeX('$\\textit{Q}_{max}$')) +
  scale_x_continuous(limits = c(-180, 180), 
                     breaks = seq(-180, 180, 60),
                     label  = long.lab) +
  scale_y_continuous(limits = c(-60, 90), 
                     breaks = seq(-60, 90, 30),
                     label  = lat.lab) +
  theme(axis.text.y.left = element_text(margin = unit(c(1, 1,1, 1), "mm"))) +
  theme_new()+
  labs(title = latex2exp::TeX('( \\textbf{g} )  $\\textit{Q}_{max}$'), size = stitle) +
  # ggtitle('(d) Qmax')+
  xlab('')+
  ylab('')+
  coord_quickmap() 

#  save Panel g
p.qmax
ggsave(paste0(path, 'figs/Fig.6/Fig.6-g.tif'),width = 6, height = 4, dpi= 300)
```

## Plot Panel h: MOCmax
```{r Panel h: MOCmax}
MOCmax_df_half = MOCmax_df
MOCmax_df_half$Cpool = MOCmax_df_half$Cpool/2

p.moc_max = ggplot() + 
  geom_tile(
    data = na.omit(MOCmax_df_half), aes(x = x, y = y, fill = Cpool )
  ) + 
  geom_point(aes(x=-179.25, y=-89.75),colour="white") + # remove added point for plotting
  geom_path(data = coastlines_sim2_df, 
            aes(x = long, y = lat, group = group),
            size=0.02) +
  scale_fill_gradientn(colours = color_bands_TSOC5, 
                       name = latex2exp::TeX('0.5*$\\MOC_{max}$')) +
  scale_x_continuous(limits = c(-180, 180), 
                     breaks = seq(-180, 180, 60),
                     label  = long.lab) +
  scale_y_continuous(limits = c(-60, 90), 
                     breaks = seq(-60, 90, 30),
                     label  = lat.lab,
                     position = "right", 
                     sec.axis = sec_axis(~., labels = NULL)) +
  theme(axis.text.y.right = element_text(margin = unit(c(1, 1,1, 1), "mm")),
        axis.ticks.y.left = element_blank()) +
  theme_new()+
  labs(title = latex2exp::TeX('( \\textbf{h} )  0.5*$\\MOC_{max}$'), size = stitle) +
  # ggtitle('(d) Qmax')+
  xlab('')+
  ylab('')+
  coord_quickmap() 

# save Panel h
p.moc_max
ggsave(paste0(path, 'figs/Fig.6/Fig.6-h.tif'),width = 6, height = 4, dpi= 300)
```

## Plot Latitude curves

```{r define fuction for plot latitude curves}
library(grid)
## define fuction for plot latitude curves
lat_curve = function(CphsMa_df)
  {
    CphsMa_dfs = na.omit(CphsMa_df)
    res = aggregate(CphsMa_dfs, by = list(CphsMa_dfs$y), FUN = "mean")
    res_df = data.frame(lat = res$Group.1, 
                        val = res[,4])
  }
 
```

```{r calculate lat curve}
## latitude line of  Cphs
Ma_df[Ma_df$x ==  -179.25 & Ma_df$y ==  -89.75,]$Cpool = NA
Mb_df[Mb_df$x ==  -179.25 & Mb_df$y ==  -89.75,]$Cpool = NA
Mc_df[Mc_df$x ==  -179.25 & Mc_df$y ==  -89.75,]$Cpool =  NA
qmax_df[qmax_df$x ==  -179.25 & qmax_df$y ==  -89.75,]$Cpool = NA
MOCmax_df[MOCmax_df$x ==  -179.25 & MOCmax_df$y ==  -89.75,]$Cpool = NA

lat_MOC  = lat_curve(MOC_df)
lat_CphsMa  = lat_curve(Ma_df)
lat_CphsMb  = lat_curve(Mb_df)
lat_CphsMc  = lat_curve(Mc_df)

lat_qmax  = lat_curve(qmax_df)
lat_MOCmax  = lat_curve(MOCmax_df)
```

```{r}
summary(lat_CphsMc);
lat_CphsMc[lat_CphsMc$val== min(lat_CphsMc$val),]$val = NA # remove abnormal point
plot(lat_CphsMc$val)
```

```{r cal lat curve}
lat_MOC$model = 'Observed'
lat_CphsMa$model = 'MIMICSa'
lat_CphsMb$model = 'MIMICSb'
lat_CphsMc$model = 'MIMICSc'
lat_qmax$model = 'Qmax' 
lat_MOCmax$model = 'MOCmax'

lat_MOC_Ma = rbind(lat_MOC,lat_CphsMa)
lat_MbMc = rbind(lat_CphsMb, lat_CphsMc, lat_MOC)
summary(lat_MOC)
```
```{r theme lat curve}
theme_new2 = function(base_size=12)
{theme(panel.background = element_rect(fill='white', colour=NA),
       panel.grid = element_blank(),
       legend.position = 'bottom',
       legend.direction = 'vertical',
       axis.text.y = element_blank(),
       axis.title.y = element_blank(),
       #legend.key.height = unit(0.25, 'cm'),
       #legend.key.width = unit(1.85, 'cm'),
       axis.ticks.length = unit(-0.1, 'cm'),
       axis.text = element_text(size= base_size,vjust=1, hjust =1,angle=45),
       axis.title = element_text(size= base_size),
       legend.text = element_text(size= 13),
       legend.title = element_blank())}
```

### Panel c: lat.MOC_Ma, latitude curvers of Cphs predited by MIMICSa vs. observation from MOC
```{r}
### plot 
col_mabc = c( 'red', 'green3', 'blue', 'gray')

#specify factor level order
lat_MOC_Ma$model = factor(lat_MOC_Ma$model, levels = c('MIMICSa', 'Observed'))

p.lat.MOC_Ma = ggplot(lat_MOC_Ma) +
  theme_bw()+
  # geom_polygon(aes(x=lat, y= poly ), fill ='grey') +
  geom_line(aes(x=lat, y= val, color = model)) +
  scale_color_manual(values = c(col_mabc[1], col_mabc[4])) +
  scale_x_continuous(limits = c(-60, 90), 
                   breaks = seq(-60, 90, 30),
                   label  = lat.lab) +
  coord_flip()  +
  theme_new2() +
  theme(axis.text = element_text(vjust=0, hjust =0.3,angle=0))+
  ylab(latex2exp::TeX('$\\textit{C}_{Phs}$   '))+ 
  labs(title = latex2exp::TeX('( \\textbf{c} )  ') ) +
  # annotate('text', x=60, y=7, label= latex2exp::TeX('$\\textit{Q}_{max}$'), col='#619cff') +
  theme(plot.margin = margin(t = 0.6 - 0.093,
                             r = 0.2,
                             b = -0.2 + 0.069,
                             l = -0.62,
                             unit = 'cm'))

```


### Panel f: lat_MbMc, latitude curvers of Cphs predited by MIMICSb and MIMICSc
```{r}
### plot 

#specify factor level order
lat_MbMc$model = factor(lat_MbMc$model, levels = c( 'MIMICSb', 'MIMICSc','Observed'))

p.lat_MbMc = ggplot(lat_MbMc) +
  theme_bw()+
  # geom_polygon(aes(x=lat, y= poly ), fill ='grey') +
  geom_line(aes(x=lat, y= val, color = model)) +
  scale_color_manual(values = col_mabc[-1]) +
  scale_x_continuous(limits = c(-60, 90), 
                     breaks = seq(-60, 90, 30),
                     label  = lat.lab) +
  coord_flip()  +
  theme_new2() +
  ylab(latex2exp::TeX('$\\textit{C}_{Phs}$   '))+ 
  labs(title = latex2exp::TeX('( \\textbf{f} )  ') ) +
  theme(plot.margin = margin(t = 0.6-0.092,
                             r = 0.2,
                             b = -0.2-0.539,
                             l = -0.42,
                             unit = 'cm'))
```

### Panel i: lat.MOCmaxQmax, latitude curvers of MOCmax and Qmax
```{r lat MOCmax Qmax}

lat_MOCmaxQmax = rbind(lat_qmax, lat_MOCmax)
legend_labs = c(expression(MOC[max]), 
                expression(~italic(Q)[max]))

p.lat.MOCmaxQmax = ggplot(lat_MOCmaxQmax) +
  theme_bw()+
  geom_line(aes(x=lat, y= val, color = model)) +

  scale_x_continuous(limits = c(-60, 90), 
                   breaks = seq(-60, 90, 30),
                   label  = lat.lab) +
  coord_flip()  +
  theme_new2() +
  theme(axis.text = element_text(vjust=0, hjust =0.3,angle=0))+
  ylab(latex2exp::TeX('$\\textit{Q}_{max}$  or $\\MOC_{max}$ '))+ 
  labs(title = latex2exp::TeX('( \\textbf{i} )  ') ) +
  theme(plot.margin = margin(t = 0.4+0.078,
                             r = 0.2,
                             b = -0.115,
                             l = -0.62,
                             unit = 'cm')) + 
  scale_color_manual(values= c('orangered3', 'gray18'),
                    labels= legend_labs)
# p.lat.MOCmaxQmax
```


```{r final plot}
ggarrange(p.MOC, p.moc_Ma,  p.lat.MOC_Ma,
          p.moc_Mb, p.moc_Mc,p.lat_MbMc,
          p.qmax, p.moc_max, p.lat.MOCmaxQmax,
          widths = c(4, 4,1),
          nrow=3, ncol=3)
```

```{r save plot}
ggsave(paste0(path, 'figs/Fig.6/Fig.6 Global MOC Mabc.eps'),width = 12, height = 11)
```


```{r}
ggsave(paste0(path, 'figs/Fig.6/Fig.6 Global MOC Mabc.tif'),width = 12, height = 11, dpi= 1200)
```
